---
title: LSPã®è£œå®Œè¡¨ç¤ºãŒç‰¹å®šæ¡ä»¶ã§è¡¨ç¤ºãŒå£Šã‚Œã‚‹
published_at: 2024-05-14T00:00:00.000Z
tag: deno
---

# LSPã®è£œå®Œè¡¨ç¤ºãŒç‰¹å®šæ¡ä»¶ã§è¡¨ç¤ºãŒå£Šã‚Œã‚‹

## æ¦‚è¦

https://github.com/denoland/deno/issues/23820
https://github.com/denoland/deno/pull/23822

```ts
/**
 *
 * @example
 * ```ts
 * const result = add(1, 2);
 * console.log(result); // 3
 * ```
 *
 * @param {number} a - The first number
 * @param {number} b - The second number
 */
export function add(a: number, b: number) {
  return a + b;
}
```

å‰è¿°ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
ã“ã‚Œã‚’importã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªè¡¨ç¤ºãŒå£Šã‚ŒãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚

![lsp_log-01](./assets/2024-05-15-01.png "lsp_log-01")

Node.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è©¦ã—ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
`"typescript": "5.3.3"`

![lsp_log-02](./assets/2024-05-15-02.png "lsp_log-02")

[JavaScriptã®modulespecifierãŒURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã‚‹-01](./2024-02-16.md)ã§UIã«è¡¨ç¤ºã•ã›ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰ãˆã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã“ã¨ã‚’æ€ã„å‡ºã—ã¦ã€
ã“ã‚Œã¨è·é›¢ãŒè¿‘ã„ã‚‚ã®ã‚’æŽ¢ã£ã¦ã„ã‘ã°ç›´ã™ã¹ãã‚³ãƒ¼ãƒ‰ã«è¿‘ã¥ã‘ãã†ã§ã™ã€‚

ã“ã®`completion_item`ã‚’ãƒ­ã‚°å‡ºåŠ›ã—ã¦ã¿ã¾ã™ã€‚

https://github.com/denoland/deno/blob/6084cf60ba0786a82aae60ad179187f17bb7dc14/cli/lsp/language_server.rs#L2192

```bash
...

ðŸ‘º > completion_resolve > : CompletionItem {
    label: "add",
    label_details: None,
    kind: Some(
        Function,
    ),
    detail: Some(
        "function add(a: number, b: number): number",
    ),
    documentation: Some(
        MarkupContent(
            MarkupContent {
                kind: Markdown,
                value: "\n\n*@example*  \n```ts\nconst result = add(1, 2);\nconsole.log(result); // 3\n```\n*@param* - a - The first number*@param* - b - The second number",
            },
        ),
    ),
    ...
```

ãƒ†ã‚­ã‚¹ãƒˆã®ç®‡æ‰€ã¯`MarkupContent`ã¨ã„ã†åå‰ã®ãƒ‡ãƒ¼ã‚¿åž‹ã®ã‚ˆã†ã§ã™ã€‚

https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#markupContent

ã“ã®`value`ã‚’æ•´å½¢ã—ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```md
*@example*  
```ts
const result = add(1, 2);
console.log(result); // 3
```*@param* - a - The first number*@param* - b - The second number
```

## åŽŸå› 

æ–‡å­—åˆ—å‡¦ç†ã®ä¸­ã§ã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚ç«¯ãŒæ”¹è¡Œ`\n`ã§çµ‚ãˆã¦ã„ãªã„ã“ã¨ã«ã‚ˆã‚‹ã‚‚ã®ã§ã—ãŸã€‚
ã¾ãŸã€hoveræ™‚ã«ã¯ç‰¹ã«è¡¨ç¤ºãŒå£Šã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚


## ç›´ã™ã¹ãç®‡æ‰€

## ãƒ¡ãƒ¢ãªã©

TypeScriptã®LSPã¨è¡¨ç¤ºã‚’ã‚ˆãè¦‹æ¯”ã¹ã‚‹ã¨ã€ç¾çŠ¶Deno LSPã§ã¯[JSDoc](https://jsdoc.app/tags-param)ã®`@param`ã‚¿ã‚°ã®`type`ã‚’æ­£ã—ããƒ‘ãƒ¼ã‚¹å‡ºæ¥ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚
ä¸‹è¨˜ã¯[è©²å½“ã™ã‚‹å‡¦ç†ã®è¿‘ã](https://github.com/denoland/deno/blob/1a788b58a0e80c4504a0fdf5d47db41c46dc8d37/cli/lsp/tsc.rs#L1324)ã§ä»•è¾¼ã‚“ã ãƒ­ã‚°å‡ºåŠ›ã§ã™ã€‚

```bash
ðŸ‘º > display_parts [
    SymbolDisplayPart {
        text: "a",
        kind: "parameterName",
        target: None,
    },
    SymbolDisplayPart {
        text: " ",
        kind: "space",
        target: None,
    },
    SymbolDisplayPart {
        text: "- The first number",
        kind: "text",
        target: None,
    },
]
ðŸ‘º > text: "a - The first number"
ðŸ‘º > body: ["", "The first number"]
ðŸ‘º > display_parts [
    SymbolDisplayPart {
        text: "b",
        kind: "parameterName",
        target: None,
    },
    SymbolDisplayPart {
        text: " ",
        kind: "space",
        target: None,
    },
    SymbolDisplayPart {
        text: "- The second number",
        kind: "text",
        target: None,
    },
]
ðŸ‘º > text: "b - The second number"
ðŸ‘º > body: ["", "The second number"]
```