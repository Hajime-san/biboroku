---
title: JavaScriptã®modulespecifierãŒURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã‚‹-02
published_at: 2024-03-13T00:00:00.000Z
tag: deno
---

# JavaScriptã®modulespecifierãŒURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã‚‹

## æ¦‚è¦

- https://github.com/denoland/deno/issues/18983\
  é–¢é€£ã™ã‚‹issue
  - https://github.com/denoland/deno/issues/10810
    - stdinã®å•é¡Œãªã®ã§ã€å¤§å…ƒã®issueã®testã®ã‚‚ã®ã¨åŒã˜

éASCIIåœã®äººã«ã¨ã£ã¦ã¯ä½¿ã„ã¥ã‚‰ã„ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://github.com/denoland/deno_core/pull/759

## åŸå› 

[JavaScriptã®modulespecifierãŒURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã‚‹-01](./2024-02-16.md)ã¨åŒã˜

## ç›´ã™ã¹ãç®‡æ‰€


## ãƒ¡ãƒ¢ãªã©

## runtimeã®æŒ™å‹•ã«ã¤ã„ã¦

Denoã®å‡ºåŠ›ã‚’è€ƒãˆã‚‹å‰ã«ã€ã¾ãšã¯æ¨™æº–ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã®æŒ™å‹•ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
ã¾ãšã¯ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="module" src="./ğŸ‹.js"></script>
</head>
<body>
</body>
</html>
```

```js
throw new Error('ğŸ‹')
```

ã“ã®htmlã‚’é©å½“ã«ç«‹ã¦ãŸã‚µãƒ¼ãƒãƒ¼ã§ãƒ›ã‚¹ãƒˆã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã™ã‚‹ã¨ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- Google Chrome

```log
ğŸ‹.js:2 Uncaught Error: ğŸ‹
    at ğŸ‹.js:2:7
(anonymous) @ ğŸ‹.js:2
```
- https://source.chromium.org/chromium/chromium/src/+/refs/tags/122.0.6261.112:v8/src/inspector/v8-stack-trace-impl.cc;l=351-367

- Firefox

```log
Uncaught Error: ğŸ‹
    <anonymous> http://localhost:8080/ğŸ‹.js:1
```

- Safari

```log
Error: ğŸ‹
module code - ğŸ‹.js:2
```

- Node.js

```log
% node ğŸ‹.mjs         
file:///path/to/%F0%9F%8D%8B.mjs:1
throw new Error('ğŸ‹')
      ^

Error: ğŸ‹
    at file:///path/to/%F0%9F%8D%8B.mjs:1:7
    at ModuleJob.run (node:internal/modules/esm/module_job:218:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:329:24)
    at async loadESM (node:internal/process/esm_loader:28:7)
    at async handleMainPromise (node:internal/modules/run_main:113:12)
```

## ä»•æ§˜

Errorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®`stack`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å„ãƒ–ãƒ©ã‚¦ã‚¶ã®å®Ÿè£…ä¾å­˜ãŒå…ˆè¡Œã—ã¦ã„ã¦ã€ä»•æ§˜ã¯ç¾åœ¨ç­–å®šé€”ä¸­ã§ã™ã€‚
- https://github.com/tc39/proposal-error-stacks

ä»•æ§˜ã‚’çœºã‚ã¦ã„ã‚‹ã¨`source`ã®éƒ¨åˆ†ã®æ–‡å­—åˆ—ãŒãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã¾ã§ã¯è¦å®šã—ã¦ã„ãªã•ãã†ã§ã™ã€‚

## stdoutã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®non-ASCIIæ–‡å­—

runtime ã®å‡¦ç†ã¯ã“ã“

- https://github.com/denoland/deno/blob/f49abcc1ac3de72bf894ccfc0102d83ec19f1d46/runtime/fmt_errors.rs#L25
- https://github.com/denoland/deno_core/blob/c14ade342c4f2247df8860c103445cba832d8f9a/core/02_error.js#L24
- https://github.com/denoland/deno_core/blob/c14ade342c4f2247df8860c103445cba832d8f9a/core/error.rs#L658

test reporterã®å‡¦ç†ã¯ã“ã“

- https://github.com/denoland/deno/blob/f49abcc1ac3de72bf894ccfc0102d83ec19f1d46/cli/tools/test/fmt.rs#L12

### è³‡æ–™ãªã©

- https://zenn.dev/pixiv/articles/bb123b2f50cdab
- https://tobyho.com/2011/06/08/the-javascript-stacktrace-blog/
- https://nhiroki.jp/2017/12/01/chromium-sourcecode